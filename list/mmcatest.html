
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>BLE + Audio Test</title>
</head>
<body>
  <h2>ğŸ§ Meta Glasses ì›¹ì•± í…ŒìŠ¤íŠ¸</h2>

  <section>
    <h3>1. ğŸ”µ BLE ìŠ¤ìº” (RSSI í¬í•¨)</h3>
    <button id="bleScanBtn">Start BLE Scan</button>
    <ul id="bleList"></ul>
  </section>

  <hr>

  <section>
    <h3>2. ğŸ™ï¸ ë§ˆì´í¬ ì…ë ¥ ì¥ì¹˜ í…ŒìŠ¤íŠ¸</h3>
    <button onclick="listMicDevices()">List Microphones</button>
    <select id="micList" style="width: 100%; margin-top: 8px;"></select>
  </section>

  <script>
    // í•„í„°ë§í•  BLE ì´ë¦„ë“¤
    const allowedNames = [
      "f03569", // 1. ìš°ì œë¥˜ë¥¼ ìœ„í•˜ì—¬
      "f06616", // 2. ë§ˆë‘
      "f07812", // 3. íŠ¸ë¦¬
      "f02313", // 4. ë™ìœ¼ë¡œ ë™ìœ¼ë¡œ
      "f02904", // 5. ë³´ì´ìŠ¤ ëª¨ì
      "f04423", // 6. ë¹„ìƒ (1983)
      "f05618", // 7. ì˜¤í˜¸ë¼ ë‚˜ëŠ” ê³¤ê³ í•œ ì‚¬ëŒì´ë¡œë‹¤
      "f06329", // 8. ê·¸ë¦¼ìë¥¼ ì‚¼í‚¤ë‹¤
      "f06685"  // 9. ë²ˆì—­ëœ ë„ìê¸°
    ];

    // BLE Scan
    document.getElementById('bleScanBtn').addEventListener('click', async () => {
      try {
        const options = {
          acceptAllAdvertisements: true
        };

        const bleList = document.getElementById('bleList');
        bleList.innerHTML = "";

        const scan = await navigator.bluetooth.requestLEScan(options);

        navigator.bluetooth.addEventListener('advertisementreceived', (event) => {
          const name = event.device.name;
          const rssi = event.rssi;

          if (allowedNames.includes(name)) {
            const li = document.createElement('li');
            li.textContent = `${name} â†’ RSSI: ${rssi} dBm`;
            bleList.appendChild(li);
          }
        });

        alert('Scanning started... Move near a BLE beacon.');

        // Stop after 15 seconds
        setTimeout(() => {
          scan.stop();
          alert('BLE Scan stopped.');
        }, 15000);

      } catch (err) {
        alert('BLE scan error: ' + err);
      }
    });

    // Microphone Device List
    async function listMicDevices() {
      try {
        await navigator.mediaDevices.getUserMedia({ audio: true });
        const devices = await navigator.mediaDevices.enumerateDevices();
        const micList = document.getElementById('micList');
        micList.innerHTML = "";

        devices
          .filter(d => d.kind === 'audioinput')
          .forEach(d => {
            const option = document.createElement('option');
            option.value = d.deviceId;
            option.textContent = d.label || `Microphone ${d.deviceId}`;
            micList.appendChild(option);
          });
      } catch (err) {
        alert('Microphone error: ' + err);
      }
    }
  </script>
</body>
</html>
